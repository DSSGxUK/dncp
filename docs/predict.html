<!DOCTYPE html>
<html lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>8 Application &amp; Prediction | DNCP Project Documentation</title>
  <meta name="description" content="This is the documentation for the DNCP Project of the Summer 2021 DSSGx Fellowship at the University of Warwick and LMU." />
  <meta name="generator" content="bookdown 0.23 and GitBook 2.6.7" />

  <meta property="og:title" content="8 Application &amp; Prediction | DNCP Project Documentation" />
  <meta property="og:type" content="book" />
  
  
  <meta property="og:description" content="This is the documentation for the DNCP Project of the Summer 2021 DSSGx Fellowship at the University of Warwick and LMU." />
  

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="8 Application &amp; Prediction | DNCP Project Documentation" />
  
  <meta name="twitter:description" content="This is the documentation for the DNCP Project of the Summer 2021 DSSGx Fellowship at the University of Warwick and LMU." />
  



<meta name="date" content="2021-08-25" />

  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  
<link rel="prev" href="train.html"/>
<link rel="next" href="eval.html"/>
<script src="libs/header-attrs-2.10/header-attrs.js"></script>
<script src="libs/jquery-3.6.0/jquery-3.6.0.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-clipboard.css" rel="stylesheet" />









<link href="libs/anchor-sections-1.0.1/anchor-sections.css" rel="stylesheet" />
<script src="libs/anchor-sections-1.0.1/anchor-sections.js"></script>


<style type="text/css">
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>


<link rel="stylesheet" href="style.css" type="text/css" />
</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li><a href="./">DNCP Documentation</a></li>

<li class="divider"></li>
<li class="chapter" data-level="1" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i><b>1</b> Introduction</a></li>
<li class="chapter" data-level="2" data-path="fe.html"><a href="fe.html"><i class="fa fa-check"></i><b>2</b> Feature Engineering</a>
<ul>
<li class="chapter" data-level="2.1" data-path="fe.html"><a href="fe.html#fe-script"><i class="fa fa-check"></i><b>2.1</b> The Script</a>
<ul>
<li class="chapter" data-level="2.1.1" data-path="fe.html"><a href="fe.html#fe-script-required-files"><i class="fa fa-check"></i><b>2.1.1</b> Required Files</a></li>
<li class="chapter" data-level="2.1.2" data-path="fe.html"><a href="fe.html#fe-script-required-r-packages"><i class="fa fa-check"></i><b>2.1.2</b> Required R Packages</a></li>
<li class="chapter" data-level="2.1.3" data-path="fe.html"><a href="fe.html#fe-script-tasks-performed"><i class="fa fa-check"></i><b>2.1.3</b> Tasks Performed</a></li>
<li class="chapter" data-level="2.1.4" data-path="fe.html"><a href="fe.html#fe-script-outputs"><i class="fa fa-check"></i><b>2.1.4</b> Outputs</a></li>
</ul></li>
<li class="chapter" data-level="2.2" data-path="fe.html"><a href="fe.html#fe-conf"><i class="fa fa-check"></i><b>2.2</b> The Configuration File</a>
<ul>
<li class="chapter" data-level="2.2.1" data-path="fe.html"><a href="fe.html#fe-conf-data-load"><i class="fa fa-check"></i><b>2.2.1</b> Loading in Data</a></li>
<li class="chapter" data-level="2.2.2" data-path="fe.html"><a href="fe.html#features"><i class="fa fa-check"></i><b>2.2.2</b> Features</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="3" data-path="buyer.html"><a href="buyer.html"><i class="fa fa-check"></i><b>3</b> Buyer Groupings</a>
<ul>
<li class="chapter" data-level="3.1" data-path="buyer.html"><a href="buyer.html#buyer-information-fields"><i class="fa fa-check"></i><b>3.1</b> Buyer Information Fields</a></li>
<li class="chapter" data-level="3.2" data-path="buyer.html"><a href="buyer.html#buyer-add-info-to-tenders"><i class="fa fa-check"></i><b>3.2</b> Adding Buyer Information to Tenders</a></li>
<li class="chapter" data-level="3.3" data-path="buyer.html"><a href="buyer.html#buyer-level"><i class="fa fa-check"></i><b>3.3</b> Buyer Levels</a></li>
<li class="chapter" data-level="3.4" data-path="buyer.html"><a href="buyer.html#buyer-name-description"><i class="fa fa-check"></i><b>3.4</b> Buyer Names and Descriptions</a></li>
<li class="chapter" data-level="3.5" data-path="buyer.html"><a href="buyer.html#buyer-frequent-words"><i class="fa fa-check"></i><b>3.5</b> Most Frequent Words</a></li>
<li class="chapter" data-level="3.6" data-path="buyer.html"><a href="buyer.html#buyer-groupings"><i class="fa fa-check"></i><b>3.6</b> Final Buyer Groupings</a></li>
<li class="chapter" data-level="3.7" data-path="buyer.html"><a href="buyer.html#buyer-variable-importance"><i class="fa fa-check"></i><b>3.7</b> Variable Importance Exploration</a></li>
<li class="chapter" data-level="3.8" data-path="buyer.html"><a href="buyer.html#buyer-conclusions"><i class="fa fa-check"></i><b>3.8</b> Implementation Conclusions</a></li>
</ul></li>
<li class="chapter" data-level="4" data-path="context.html"><a href="context.html"><i class="fa fa-check"></i><b>4</b> Context Groupings</a>
<ul>
<li class="chapter" data-level="4.1" data-path="context.html"><a href="context.html#context-information-fields"><i class="fa fa-check"></i><b>4.1</b> Context Information Fields</a></li>
<li class="chapter" data-level="4.2" data-path="context.html"><a href="context.html#context-frequent-words"><i class="fa fa-check"></i><b>4.2</b> Most Frequent Words</a></li>
<li class="chapter" data-level="4.3" data-path="context.html"><a href="context.html#context-word-assoc"><i class="fa fa-check"></i><b>4.3</b> Most Frequent Word Associations</a></li>
<li class="chapter" data-level="4.4" data-path="context.html"><a href="context.html#context-word-regression"><i class="fa fa-check"></i><b>4.4</b> Most Influential Words</a></li>
<li class="chapter" data-level="4.5" data-path="context.html"><a href="context.html#context-groupings"><i class="fa fa-check"></i><b>4.5</b> Final Context Groupings</a></li>
<li class="chapter" data-level="4.6" data-path="context.html"><a href="context.html#context-conclusions"><i class="fa fa-check"></i><b>4.6</b> Implementation Conclusions</a></li>
</ul></li>
<li class="chapter" data-level="5" data-path="outlier.html"><a href="outlier.html"><i class="fa fa-check"></i><b>5</b> Outlier Removal</a>
<ul>
<li class="chapter" data-level="5.1" data-path="outlier.html"><a href="outlier.html#outlier-anomaly-scores"><i class="fa fa-check"></i><b>5.1</b> Anomaly Scores</a></li>
<li class="chapter" data-level="5.2" data-path="outlier.html"><a href="outlier.html#outlier-statistics"><i class="fa fa-check"></i><b>5.2</b> Outlier Statistics</a></li>
<li class="chapter" data-level="5.3" data-path="outlier.html"><a href="outlier.html#outlier-descriptions"><i class="fa fa-check"></i><b>5.3</b> Outlier Descriptions</a></li>
<li class="chapter" data-level="5.4" data-path="outlier.html"><a href="outlier.html#outlier-conclusions"><i class="fa fa-check"></i><b>5.4</b> Implementation Conclusions</a></li>
</ul></li>
<li class="chapter" data-level="6" data-path="eda.html"><a href="eda.html"><i class="fa fa-check"></i><b>6</b> Exploratory Data Analysis</a>
<ul>
<li class="chapter" data-level="6.1" data-path="eda.html"><a href="eda.html#eda-pdf"><i class="fa fa-check"></i><b>6.1</b> The PDF File</a>
<ul>
<li class="chapter" data-level="6.1.1" data-path="eda.html"><a href="eda.html#eda-pdf-types"><i class="fa fa-check"></i><b>6.1.1</b> Types of EDA Performed</a></li>
</ul></li>
<li class="chapter" data-level="6.2" data-path="eda.html"><a href="eda.html#eda-data-dictionary"><i class="fa fa-check"></i><b>6.2</b> The Data Dictionary</a></li>
</ul></li>
<li class="chapter" data-level="7" data-path="train.html"><a href="train.html"><i class="fa fa-check"></i><b>7</b> Training</a>
<ul>
<li class="chapter" data-level="7.1" data-path="train.html"><a href="train.html#train-script"><i class="fa fa-check"></i><b>7.1</b> The Script</a>
<ul>
<li class="chapter" data-level="7.1.1" data-path="train.html"><a href="train.html#train-script-files"><i class="fa fa-check"></i><b>7.1.1</b> Required Files</a></li>
<li class="chapter" data-level="7.1.2" data-path="train.html"><a href="train.html#train-script-required-r-packages"><i class="fa fa-check"></i><b>7.1.2</b> Required R Packages</a></li>
<li class="chapter" data-level="7.1.3" data-path="train.html"><a href="train.html#train-script-tasks"><i class="fa fa-check"></i><b>7.1.3</b> Tasks Performed by the Script</a></li>
<li class="chapter" data-level="7.1.4" data-path="train.html"><a href="train.html#train-conf-outputs"><i class="fa fa-check"></i><b>7.1.4</b> Outputs</a></li>
</ul></li>
<li class="chapter" data-level="7.2" data-path="train.html"><a href="train.html#train-conf"><i class="fa fa-check"></i><b>7.2</b> The Configuration File</a>
<ul>
<li class="chapter" data-level="7.2.1" data-path="train.html"><a href="train.html#train-conf-data"><i class="fa fa-check"></i><b>7.2.1</b> Data</a></li>
<li class="chapter" data-level="7.2.2" data-path="train.html"><a href="train.html#train-conf-model"><i class="fa fa-check"></i><b>7.2.2</b> Model</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="8" data-path="predict.html"><a href="predict.html"><i class="fa fa-check"></i><b>8</b> Application &amp; Prediction</a>
<ul>
<li class="chapter" data-level="8.1" data-path="predict.html"><a href="predict.html#predict-script"><i class="fa fa-check"></i><b>8.1</b> The Script</a>
<ul>
<li class="chapter" data-level="8.1.1" data-path="predict.html"><a href="predict.html#predict-script-required-files"><i class="fa fa-check"></i><b>8.1.1</b> Required Files</a></li>
<li class="chapter" data-level="8.1.2" data-path="predict.html"><a href="predict.html#predict-script-required-r-packages"><i class="fa fa-check"></i><b>8.1.2</b> Required R Packages</a></li>
<li class="chapter" data-level="8.1.3" data-path="predict.html"><a href="predict.html#predict-script-tasks"><i class="fa fa-check"></i><b>8.1.3</b> Tasks Performed in the Script</a></li>
<li class="chapter" data-level="8.1.4" data-path="predict.html"><a href="predict.html#predict-script-fe"><i class="fa fa-check"></i><b>8.1.4</b> Feature Engineering on New Data</a></li>
<li class="chapter" data-level="8.1.5" data-path="predict.html"><a href="predict.html#predict-script-make-predictions"><i class="fa fa-check"></i><b>8.1.5</b> Making Predictions on New Data</a></li>
<li class="chapter" data-level="8.1.6" data-path="predict.html"><a href="predict.html#predict-script-outputs"><i class="fa fa-check"></i><b>8.1.6</b> Outputs</a></li>
</ul></li>
<li class="chapter" data-level="8.2" data-path="predict.html"><a href="predict.html#predict-conf"><i class="fa fa-check"></i><b>8.2</b> The Configuration File</a>
<ul>
<li class="chapter" data-level="8.2.1" data-path="predict.html"><a href="predict.html#predict-conf-data"><i class="fa fa-check"></i><b>8.2.1</b> Data</a></li>
<li class="chapter" data-level="8.2.2" data-path="predict.html"><a href="predict.html#predict-conf-features"><i class="fa fa-check"></i><b>8.2.2</b> Features</a></li>
<li class="chapter" data-level="8.2.3" data-path="predict.html"><a href="predict.html#predict-conf-model"><i class="fa fa-check"></i><b>8.2.3</b> Model</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="9" data-path="eval.html"><a href="eval.html"><i class="fa fa-check"></i><b>9</b> Model Evaluation</a>
<ul>
<li class="chapter" data-level="9.1" data-path="eval.html"><a href="eval.html#eval-metrics"><i class="fa fa-check"></i><b>9.1</b> Evaluation Metrics</a>
<ul>
<li class="chapter" data-level="9.1.1" data-path="eval.html"><a href="eval.html#eval-rmse"><i class="fa fa-check"></i><b>9.1.1</b> RMSE</a></li>
<li class="chapter" data-level="9.1.2" data-path="eval.html"><a href="eval.html#eval-range"><i class="fa fa-check"></i><b>9.1.2</b> Range</a></li>
<li class="chapter" data-level="9.1.3" data-path="eval.html"><a href="eval.html#eval-rsq"><i class="fa fa-check"></i><b>9.1.3</b> <span class="math inline">\(R^2\)</span></a></li>
<li class="chapter" data-level="9.1.4" data-path="eval.html"><a href="eval.html#eval-mae"><i class="fa fa-check"></i><b>9.1.4</b> MAE</a></li>
</ul></li>
<li class="chapter" data-level="9.2" data-path="eval.html"><a href="eval.html#eval-important-features"><i class="fa fa-check"></i><b>9.2</b> Most Important Features</a></li>
<li class="chapter" data-level="9.3" data-path="eval.html"><a href="eval.html#eval-models"><i class="fa fa-check"></i><b>9.3</b> Models Used</a>
<ul>
<li class="chapter" data-level="9.3.1" data-path="eval.html"><a href="eval.html#eval-ols"><i class="fa fa-check"></i><b>9.3.1</b> Linear Regression</a></li>
<li class="chapter" data-level="9.3.2" data-path="eval.html"><a href="eval.html#eval-rf"><i class="fa fa-check"></i><b>9.3.2</b> Random Forest</a></li>
<li class="chapter" data-level="9.3.3" data-path="eval.html"><a href="eval.html#eval-xgb"><i class="fa fa-check"></i><b>9.3.3</b> XGBoost</a></li>
</ul></li>
<li class="chapter" data-level="9.4" data-path="eval.html"><a href="eval.html#eval-top-10"><i class="fa fa-check"></i><b>9.4</b> Top 10 Most Important Features</a>
<ul>
<li class="chapter" data-level="9.4.1" data-path="eval.html"><a href="eval.html#eval-top-10-goods"><i class="fa fa-check"></i><b>9.4.1</b> Goods-Only Dataset</a></li>
<li class="chapter" data-level="9.4.2" data-path="eval.html"><a href="eval.html#eval-top-10-services"><i class="fa fa-check"></i><b>9.4.2</b> Services-Only Dataset</a></li>
<li class="chapter" data-level="9.4.3" data-path="eval.html"><a href="eval.html#eval-top-10-combined"><i class="fa fa-check"></i><b>9.4.3</b> Combined Dataset</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="10" data-path="conclusions.html"><a href="conclusions.html"><i class="fa fa-check"></i><b>10</b> Conclusions</a>
<ul>
<li class="chapter" data-level="10.1" data-path="conclusions.html"><a href="conclusions.html#outcomes"><i class="fa fa-check"></i><b>10.1</b> Outcomes</a></li>
<li class="chapter" data-level="10.2" data-path="conclusions.html"><a href="conclusions.html#limitations"><i class="fa fa-check"></i><b>10.2</b> Limitations</a></li>
</ul></li>
<li class="divider"></li>
<li><a href="https://github.com/rstudio/bookdown" target="blank">Published with bookdown</a></li>
</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">DNCP Project Documentation</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="predict" class="section level1" number="8">
<h1><span class="header-section-number">8</span> Application &amp; Prediction</h1>
<div id="predict-script" class="section level2" number="8.1">
<h2><span class="header-section-number">8.1</span> The Script</h2>
<p>The prediction script takes new raw data as inputs, and performs necessary feature engineering on the data consistent with the feature engineering done before model training and then uses a previously trained model to predict the unit price of each row in the data. The output consists of an Excel file with the merged new raw data that also contains these predictions.</p>
<div id="predict-script-required-files" class="section level3" number="8.1.1">
<h3><span class="header-section-number">8.1.1</span> Required Files</h3>
<p>The <code>predict.R</code> script is not a self-contained script and requires the input of new raw data and other scripts containing helper functions. The following is a list of necessary files and the structure they should follow within the <code>dncp</code> folder:</p>
<ul>
<li><code>src/</code>
<ul>
<li><code>scripts/</code>
<ul>
<li><code>predict.R</code> (encompassing script to run)</li>
</ul></li>
<li><code>functions/</code>
<ul>
<li><code>predict_helpers.R</code> (set of helper functions to perform tasks in <code>predict.R</code>)</li>
<li><code>fe_helpers.R</code> (set of helper functions to conduct feature engineering tasks in <code>predict.R</code>)</li>
</ul></li>
</ul></li>
<li><code>conf/</code>
<ul>
<li><code>predict_conf.yaml</code> (configuration file for <code>predict.R</code>)</li>
<li><code>merge_sparse.yaml</code> (configuration file containing categories after merging sparse categories)</li>
<li><code>valid_categories.yaml</code> (configuration file containing values to be used to replace new categories in categorical variables)</li>
</ul></li>
</ul>
<p>In addition to the above files, the <code>predict.R</code> script requires new raw data that the user wishes to generate predicted unit price values for. The required datasets are listed below, and they should all be stored in the same directory; the name of this directory should be inputted into the <code>predict_conf.yaml</code> file at <code>data$loc</code> (the default directory is <code>data/raw/</code>).</p>
<ul>
<li><code>data</code>
<ul>
<li><code>item_solicitado.csv</code></li>
<li><code>llamado_grupo.csv</code></li>
<li><code>llamado.csv</code></li>
<li><code>pac.csv</code></li>
<li><code>producto_n5.csv</code></li>
<li><code>producto_n4.csv</code></li>
<li><code>producto_n3.csv</code></li>
<li><code>producto_n2.csv</code></li>
<li><code>producto_n1.csv</code></li>
<li><code>unidad_contratacion.csv</code></li>
<li><code>entidad.csv</code></li>
<li><code>nivel_entidad.csv</code></li>
</ul></li>
</ul>
</div>
<div id="predict-script-required-r-packages" class="section level3" number="8.1.2">
<h3><span class="header-section-number">8.1.2</span> Required R Packages</h3>
<p>The following is a list of R packages necessary for running <code>predict.R</code> and its associated scripts and reports.</p>
<ul>
<li><code>caret</code></li>
<li><code>lubridate</code></li>
<li><code>solitude</code></li>
<li><code>tidyverse</code></li>
<li><code>yaml</code></li>
<li><code>openxlsx</code></li>
<li><code>glue</code></li>
</ul>
</div>
<div id="predict-script-tasks" class="section level3" number="8.1.3">
<h3><span class="header-section-number">8.1.3</span> Tasks Performed in the Script</h3>
<p>The <code>predict.R</code> script takes in an already trained model that is used to predict unit price values for the new raw data. For more information on how such models are trained, please look at <a href="train.html#train">Training Documentation</a>.</p>
</div>
<div id="predict-script-fe" class="section level3" number="8.1.4">
<h3><span class="header-section-number">8.1.4</span> Feature Engineering on New Data</h3>
<p>Once the new raw datasets are loaded and merged in <code>predict.R</code>, they are adjusted through feature engineering tasks so that they are in the correct format to apply the model on them. The feature engineering tasks will be briefly reviewed in this section, but for more specific information on the separate tasks, please look at <a href="fe.html#fe">Feature Engineering Documentation</a>.</p>
<p>A new variable is first created in the dataset that indicates whether an item is a good or a service (denoted with a <code>1</code> if the item is a service and <code>0</code> otherwise). Then, any pre-set filters in the feature engineering configuration file are applied to the dataset, filtering out specific rows as desired.</p>
<p>Next, prices in the dataset are adjusted for inflation, and new grouping variables indicating the buyer of each item and the context of each item (i.e. what they are used for) are added. Then, the predictor variables, as well as extra variables providing descriptions of each item and the date of their execution in public procurement, are selected from the overall dataset.</p>
<p>Next, any skewed numeric variables are log-transformed as specified in the feature engineering configuration file, after which sparse categories are merged based on which categories remained after merging in the feature engineering script; these categories are saved in the <code>merge_sparse.yaml</code> configuration file. The sparse categories are determined by first identifying in the feature engineering script which categories in each categorical variable have the lowest frequencies; those categories are then saved, and they are merged in the <code>predict.R</code> script regardless of their frequencies in the new raw input data. This is required in order to stay consistent with findings from the training dataset.</p>
<p>A one-hot encoding model previously saved from the <code>fe.R</code> script is then loaded and applied to the new raw data; the model can be specified in the <code>predict_conf.yaml</code> configuration file (<a href="predict.html#predict-conf-model">see below</a>). The one-hot encoding creates a new binary indicator variable for each category in categorical variables in the data (i.e. if one category in the categorical variable <code>fruit</code> is <code>apple</code>, then one-hot encoding would create a new binary variable <code>apple</code> that is equal to 1 if the item is in the <code>apple</code> category and 0 otherwise). New categories in categorical variables are set to the corresponding category in <code>valid_categories.yaml</code>, which is either the “Other” category or the most frequent category in the categorical variable. Lastly, any missing values are imputed by assigning <code>NA</code> or <code>0</code> to appropriate missing feature variables values.</p>
</div>
<div id="predict-script-make-predictions" class="section level3" number="8.1.5">
<h3><span class="header-section-number">8.1.5</span> Making Predictions on New Data</h3>
<p>After the feature engineering is complete, a previously saved model is loaded to make predictions on the completely adjusted new data. The saved model is loaded from an existing <code>RDS</code> file generated from the <code>training.R</code> script; the model can be specified in the <code>predict_conf.yaml</code> configuration file (<a href="predict.html#predict-conf-model">see below</a>). Then, the new data is pruned by selecting all predictors and dropping any missing values. Lastly, the predicted values for the log unit price are calculated using the model, and both the log unit price and unit price are stored in the new dataset.</p>
<div id="predict-script-store-predictions" class="section level4" number="8.1.5.1">
<h4><span class="header-section-number">8.1.5.1</span> Storing Predictions</h4>
<p>The resulting predictions are then stored in two ways. First, an RDS file containing the full new dataset along with two additional new columns representing the predicted log unit price and predicted unit price are created; this file is stored in the <code>data/output/</code> directory. Second, an Excel file containing the item ID, the descriptions from <code>item_solicitado</code>, <code>llamado_grupo</code>, and <code>llamado</code>, the execution date, and predicted log unit price and unit price is created and stored in the <code>data/output/</code> directory.</p>
</div>
</div>
<div id="predict-script-outputs" class="section level3" number="8.1.6">
<h3><span class="header-section-number">8.1.6</span> Outputs</h3>
<p>The following are the outputs produced by running <code>predict.R</code>.</p>
<ul>
<li><code>data/</code>
<ul>
<li><code>output/dataset_DATE_with_predictions.rds</code> (RDS file containing all predictors as columns as well as the predicted values for the log unit price and unit price for each row)</li>
<li><code>output/dataset_DATE_with_predictions.xlsx</code> (Excel file containing some relevant description and date predictors as columns as well as the predictions for the log unit price and unit price)</li>
</ul></li>
</ul>
</div>
</div>
<div id="predict-conf" class="section level2" number="8.2">
<h2><span class="header-section-number">8.2</span> The Configuration File</h2>
<p>The configuration file <code>predict_conf.yaml</code> contains the inputs for the tasks outlined <a href="predict.html#predict-script-tasks">above</a>. This file needs to be altered for any desired change of input, and instructions for how those alterations can be made are listed below. The application/prediction configuration file is broken down into three stages: the Data, the Features, and the Model.</p>
<div id="predict-conf-data" class="section level3" number="8.2.1">
<h3><span class="header-section-number">8.2.1</span> Data</h3>
<p>To load in the correct new input data, the <code>data$loc</code> value should contain the directory in which the new input data files are located. The default value is <code>data/raw/</code>; however, to use a different data directory, the data files can simply be put into a new directory, and the path of the new directory can be listed at <code>loc</code>. Similarly, the <code>dest</code> directory should contain the directory where the user desires the outputs from <code>predict.R</code> to be stored. The <code>dest</code> directory can also be changed if the user wishes to have outputs stored somewhere other than the default directory.</p>
<div class="sourceCode" id="cb19"><pre class="sourceCode yaml"><code class="sourceCode yaml"><span id="cb19-1"><a href="predict.html#cb19-1" aria-hidden="true" tabindex="-1"></a><span class="fu">data</span><span class="kw">:</span></span>
<span id="cb19-2"><a href="predict.html#cb19-2" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">loc</span><span class="kw">:</span><span class="at"> </span><span class="st">&#39;data/raw/&#39;</span></span>
<span id="cb19-3"><a href="predict.html#cb19-3" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">dest</span><span class="kw">:</span><span class="at"> </span><span class="st">&#39;data/output/&#39;</span></span></code></pre></div>
<p>Other values in the <code>data</code> section of the configuration files are the required input CSV files; these values should not be changed.</p>
</div>
<div id="predict-conf-features" class="section level3" number="8.2.2">
<h3><span class="header-section-number">8.2.2</span> Features</h3>
<p>The <code>features</code> section contains the merging ID and variables to be one-hot encoded and log-transformed. The ID should not be altered; however, to add any variables to be one-hot encoded or log-transformed, simply append them to the <code>one_hot_encoded_vars</code> list and <code>log_transforms</code> list respectively while ensuring that the variable names are enclosed in single quotations as shown.</p>
<div class="sourceCode" id="cb20"><pre class="sourceCode yaml"><code class="sourceCode yaml"><span id="cb20-1"><a href="predict.html#cb20-1" aria-hidden="true" tabindex="-1"></a><span class="fu">features</span><span class="kw">:</span></span>
<span id="cb20-2"><a href="predict.html#cb20-2" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">id</span><span class="kw">:</span><span class="at"> </span><span class="st">&#39;item_solicitado_id&#39;</span><span class="co"> # unique id</span></span>
<span id="cb20-3"><a href="predict.html#cb20-3" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">one_hot_encoded_vars</span><span class="kw">:</span></span>
<span id="cb20-4"><a href="predict.html#cb20-4" aria-hidden="true" tabindex="-1"></a><span class="at">        </span><span class="kw">[</span><span class="st">&#39;tipo_unidad_contratacion&#39;</span><span class="kw">,</span></span>
<span id="cb20-5"><a href="predict.html#cb20-5" aria-hidden="true" tabindex="-1"></a><span class="at">         </span><span class="st">&#39;nombre_nivel_entidad&#39;</span><span class="kw">,</span></span>
<span id="cb20-6"><a href="predict.html#cb20-6" aria-hidden="true" tabindex="-1"></a><span class="at">         </span><span class="st">&#39;forma_adjudicacion_llamado&#39;</span><span class="kw">,</span></span>
<span id="cb20-7"><a href="predict.html#cb20-7" aria-hidden="true" tabindex="-1"></a><span class="at">         </span><span class="st">&#39;forma_pago_llamado&#39;</span><span class="kw">,</span></span>
<span id="cb20-8"><a href="predict.html#cb20-8" aria-hidden="true" tabindex="-1"></a><span class="at">         </span><span class="st">&#39;descripcion_ingles_producto_n1&#39;</span><span class="kw">]</span></span>
<span id="cb20-9"><a href="predict.html#cb20-9" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">log_transforms</span><span class="kw">:</span><span class="at"> </span></span></code></pre></div>
<p>Also included in the <code>features</code> section is the <code>extra_vars</code> list, which contains a list of non-predictor variables in the dataset that the user wishes to see in the final output. For example, <code>decripcion_item_solicitado</code> is not a predictor in the model training, but contains useful information on the nature of each item; thus, it could be included in <code>extra_vars</code>. To add variables to <code>extra_vars</code>, simply append them to the list and ensure that their names are enclosed in single quotations as shown below.</p>
<div class="sourceCode" id="cb21"><pre class="sourceCode yaml"><code class="sourceCode yaml"><span id="cb21-1"><a href="predict.html#cb21-1" aria-hidden="true" tabindex="-1"></a><span class="fu">extra_vars</span><span class="kw">:</span><span class="at"> </span><span class="kw">[</span><span class="st">&#39;item_solicitado_id&#39;</span><span class="kw">,</span></span>
<span id="cb21-2"><a href="predict.html#cb21-2" aria-hidden="true" tabindex="-1"></a><span class="at">             </span><span class="st">&#39;descripcion_item_solicitado&#39;</span><span class="kw">,</span></span>
<span id="cb21-3"><a href="predict.html#cb21-3" aria-hidden="true" tabindex="-1"></a><span class="at">             </span><span class="st">&#39;descripcion_llamado_grupo&#39;</span><span class="kw">,</span></span>
<span id="cb21-4"><a href="predict.html#cb21-4" aria-hidden="true" tabindex="-1"></a><span class="at">             </span><span class="st">&#39;descripcion_llamado&#39;</span><span class="kw">,</span></span>
<span id="cb21-5"><a href="predict.html#cb21-5" aria-hidden="true" tabindex="-1"></a><span class="at">             </span><span class="st">&#39;fecha_ejecucion_pac&#39;</span><span class="kw">]</span></span></code></pre></div>
</div>
<div id="predict-conf-model" class="section level3" number="8.2.3">
<h3><span class="header-section-number">8.2.3</span> Model</h3>
<p>The <code>model</code> section contains the directory of the final predictive model and one-hot encoding model to be used to generate predictions on the new raw data. The predictive model’s directory and file name can be changed by writing the directory in the <code>loc</code> value of <code>model</code> and the file name in the <code>winning_model</code> value of <code>model</code>. The one-hot encoding model, which is generated by running the <code>fe.R</code> script, can have its directory and file name updated by changing the <code>loc</code> value in <code>ohe_model</code> to the directory the one-hot encoding model is located in and changing the <code>last_run_date</code> value in <code>ohe_model</code> to the most recent date when the <code>fe.R</code> script was run.</p>
<div class="sourceCode" id="cb22"><pre class="sourceCode yaml"><code class="sourceCode yaml"><span id="cb22-1"><a href="predict.html#cb22-1" aria-hidden="true" tabindex="-1"></a><span class="fu">model</span><span class="kw">:</span></span>
<span id="cb22-2"><a href="predict.html#cb22-2" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">loc</span><span class="kw">:</span><span class="at"> </span><span class="st">&#39;/files/&#39;</span><span class="co"> # loc is input path</span></span>
<span id="cb22-3"><a href="predict.html#cb22-3" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">winning_model</span><span class="kw">:</span><span class="at"> </span><span class="st">&#39;model_inter_final.rds&#39;</span></span>
<span id="cb22-4"><a href="predict.html#cb22-4" aria-hidden="true" tabindex="-1"></a><span class="fu">ohe_model</span><span class="kw">:</span></span>
<span id="cb22-5"><a href="predict.html#cb22-5" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">loc</span><span class="kw">:</span><span class="at"> </span><span class="st">&#39;data/output/&#39;</span></span>
<span id="cb22-6"><a href="predict.html#cb22-6" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">last_run_date</span><span class="kw">:</span><span class="at"> </span><span class="st">&#39;2021-08-11&#39;</span></span></code></pre></div>

</div>
</div>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="train.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="eval.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/lunr.js"></script>
<script src="libs/gitbook-2.6.7/js/clipboard.min.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": false,
"facebook": true,
"twitter": true,
"linkedin": false,
"weibo": false,
"instapaper": false,
"vk": false,
"whatsapp": false,
"all": ["facebook", "twitter", "linkedin", "weibo", "instapaper"]
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": null,
"text": null
},
"history": {
"link": null,
"text": null
},
"view": {
"link": null,
"text": null
},
"download": null,
"search": {
"engine": "lunr",
"options": null
},
"toc": {
"collapse": "subsection"
}
});
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "true";
    if (src === "" || src === "true") src = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:")
      if (/^https?:/.test(src))
        src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>
</body>

</html>
